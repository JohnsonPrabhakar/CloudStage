rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Artists can only manage their own profile.
    match /artists/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Events can be read by anyone if approved.
    // An artist can read their own events regardless of status.
    // An artist can only create/update their own events.
    match /events/{eventId} {
      allow read: if resource.data.moderationStatus == 'approved' || (request.auth != null && request.auth.uid == resource.data.artistId);
      allow write: if request.auth != null && request.auth.uid == request.resource.data.artistId;
    }

    // Users can only manage their own tickets.
    match /tickets/{ticketId} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
    }

    // Movies can be read by anyone.
    // Only the admin can create, update, or delete movies.
    match /movies/{movieId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.email == 'admin@cloudstage.in';
    }

    // Site configuration can be read by anyone, but only written by admin.
    match /config/siteStatus {
        allow read: if true;
        allow write: if request.auth != null && request.auth.token.email == 'admin@cloudstage.in';
    }
  }
}