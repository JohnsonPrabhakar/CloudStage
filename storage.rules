
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // --- Helper Functions ---
    function isAuth() {
      return request.auth != null;
    }

    function isAdmin() {
      // The single source of truth for admin role is the email address in the auth token.
      return isAuth() && request.auth.token.email == 'admin@cloudstage.in';
    }

    // --- File Access Rules ---

    // By default, allow public read access on all files. This is necessary for
    // users to see images and watch videos. Write access is restricted below.
    match /{allPaths=**} {
      allow get: if true;
    }

    // --- Secure Write Rules ---
    
    // Artists can only write a profile picture to their own designated folder.
    match /artists/{artistId}/profile.jpg {
      allow write: if isAuth() && request.auth.uid == artistId;
    }
    
    // Artists can only write banners to events associated with their own artistId.
    match /artists/{artistId}/events/{eventId}/banner.jpg {
       allow write: if isAuth() && request.auth.uid == artistId;
    }

    // Only admins can upload movie files and posters to the movies folder.
    match /movies/{movieId}/{allPaths=**} {
        allow write: if isAdmin();
    }
  }
}

    